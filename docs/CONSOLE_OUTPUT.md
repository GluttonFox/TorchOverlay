# 控制台输出说明

## 概述

系统会在控制台输出详细的运行信息，方便调试和了解系统状态。以下是所有输出的说明。

## 输出分类

### 1. 游戏日志监控输出 `[日志监控]`

#### 启动信息
```
[日志监控] 启动成功，每 2.0 秒检查一次日志
[日志监控] 正在监控: D:\TapTap\PC Games\172664\UE_game\Torchlight\Saved\Logs\UE_game.log (大小: 123456 字节)
```

**说明**：
- 系统启动游戏日志监控
- 每2秒检查一次日志文件
- 显示日志文件路径和大小

#### 购买事件检测
```
[日志监控] ✓ 检测到购买事件: 初火源质 x1, 消耗神威辉石: 50, 时间: 14:30:45
```

**说明**：
- 从游戏日志中检测到购买物品的事件
- 显示物品名称、数量、消耗的神威辉石数量和时间

#### 刷新商店事件
```
[日志监控] ✓ 检测到刷新商店事件, 消耗神威辉石: 50, 时间: 14:30:30
```

**说明**：
- 从游戏日志中检测到刷新商店的事件
- 显示消耗的神威辉石数量（通常为50）

#### 错误信息
```
[日志监控] ✗ 解析日志失败: [错误详情]
```

**说明**：
- 日志文件解析失败
- 可能是文件损坏或格式错误

---

### 2. 验证服务输出 `[验证服务]`

#### OCR识别结果
```
[验证服务] 添加OCR识别结果: 初火源质 x1, 价格: 50, 利润: 0.21
```

**说明**：
- 用户识别了一个物品
- 记录保存在验证池中，等待游戏日志事件进行验证

#### 购买事件
```
[验证服务] 添加购买事件: 初火源质, 消耗神威辉石: 50
```

**说明**：
- 从游戏日志中检测到购买事件
- 添加到验证服务的事件池

#### 匹配事件
```
[验证服务] ✓ 找到匹配事件: 时间差=5.2s, 物品=初火源质, 消耗=50
```

**说明**：
- OCR识别结果与游戏日志事件匹配成功
- 显示时间差、物品名称和神威辉石消耗

#### 验证通过
```
[验证服务] ✓ 验证通过: 初火源质 x1, 利润: 0.21
```

**说明**：
- 交叉验证成功
- 将保存到 `exchange_log.json`

#### 未找到匹配
```
[验证服务] - 未找到匹配事件: 初火源质, OCR价格=50, 缓存事件数=3
```

**说明**：
- OCR识别结果未能与游戏日志事件匹配
- 可能是用户没有实际购买，或者时间窗口已过

---

### 3. 兑换监控输出 `[兑换监控]`

#### 启动信息
```
[兑换监控] 启动成功，每 5.0 秒验证一次兑换记录
```

**说明**：
- 兑换监控服务启动
- 每5秒执行一次验证和保存操作

#### 保存兑换记录
```
[兑换日志] 成功保存 1 条验证通过的记录
```

**说明**：
- 验证通过的记录已保存到 `exchange_log.json`

#### 保存刷新记录
```
[兑换监控] ✓ 保存了 2 条刷新记录到 refresh_log.json
```

**说明**：
- 刷新商店事件已保存到 `refresh_log.json`

#### 清理过期记录
```
[兑换监控] 清理了 5 条过期的OCR记录
```

**说明**：
- 清理了超过60秒的未验证OCR记录
- 释放内存和存储空间

---

### 4. 系统初始化输出

#### 窗口绑定
```
============================================================
游戏日志监控初始化
============================================================
游戏进程路径: D:\TapTap\PC Games\172664\UE_game\Binaries\Win64\torchlight_infinite.exe
游戏进程目录: D:\TapTap\PC Games\172664\UE_game\Binaries\Win64
UE_game目录: D:\TapTap\PC Games\172664\UE_game
游戏日志路径: D:\TapTap\PC Games\172664\UE_game\Torchlight\Saved\Logs\UE_game.log
============================================================
✓ 日志文件存在 (大小: 123456 字节)
============================================================
✓ 游戏日志监控已启动
```

**说明**：
- 窗口绑定游戏后自动初始化日志监控
- 显示进程路径、日志路径等信息
- 检查日志文件是否存在

---

## 完整工作流程示例

### 成功购买流程

```
1. 用户识别物品
   [验证服务] 添加OCR识别结果: 初火源质 x1, 价格: 50, 利润: 0.21

2. 游戏日志检测到购买
   [日志监控] ✓ 检测到购买事件: 初火源质 x1, 消耗神威辉石: 50, 时间: 14:30:45

3. 验证服务添加事件
   [验证服务] 添加购买事件: 初火源质, 消耗神威辉石: 50

4. 定期验证（每5秒）
   [验证服务] ✓ 找到匹配事件: 时间差=3.2s, 物品=初火源质, 消耗=50
   [验证服务] ✓ 验证通过: 初火源质 x1, 利润: 0.21

5. 保存到日志
   [兑换日志] 成功保存 1 条验证通过的记录

6. 兑换日志窗口显示记录
```

### 刷新商店流程

```
1. 游戏日志检测到刷新
   [日志监控] ✓ 检测到刷新商店事件, 消耗神威辉石: 50, 时间: 14:30:30

2. 验证服务添加事件
   [验证服务] 添加刷新事件: RefreshEvent(gem_cost=50)

3. 保存刷新记录
   [兑换监控] ✓ 保存了 1 条刷新记录到 refresh_log.json
```

### 识别但未购买流程

```
1. 用户识别物品
   [验证服务] 添加OCR识别结果: 初火源质 x1, 价格: 50, 利润: 0.21

2. 超过60秒未匹配
   [验证服务] - 未找到匹配事件: 初火源质, OCR价格=50, 缓存事件数=0

3. 自动清理
   [兑换监控] 清理了 1 条过期的OCR记录
```

## 符号说明

| 符号 | 含义 |
|------|------|
| ✓ | 成功操作 |
| ✗ | 失败操作 |
| - | 信息提示（非错误） |
| ⚠ | 警告信息 |

## 调试技巧

### 1. 确认日志监控正常
查看是否有以下输出：
```
[日志监控] 正在监控: [日志路径]
```

### 2. 确认游戏日志可读取
尝试在游戏中购买或刷新物品，查看是否有输出：
```
[日志监控] ✓ 检测到购买事件: ...
[日志监控] ✓ 检测到刷新商店事件: ...
```

### 3. 确认验证功能正常
识别一个物品并购买，查看是否有以下输出：
```
[验证服务] 添加OCR识别结果: ...
[验证服务] 添加购买事件: ...
[验证服务] ✓ 找到匹配事件: ...
[验证服务] ✓ 验证通过: ...
[兑换日志] 成功保存 1 条验证通过的记录
```

### 4. 检查未匹配原因
如果看到"未找到匹配事件"输出，检查：
- 时间差是否在30秒内
- 神威辉石消耗是否一致
- 物品名称是否能正确匹配

## 常见问题

### Q: 为什么看不到 `[日志监控]` 的输出？

A: 可能的原因：
1. 窗口未绑定游戏
2. 游戏日志文件不存在
3. 游戏日志监控未启动

### Q: 为什么看到"未找到匹配事件"？

A: 可能的原因：
1. 用户识别后没有实际购买物品
2. 识别和购买之间的时间超过30秒
3. OCR识别的神威辉石数量与实际消耗不一致

### Q: 控制台输出太多，如何减少？

A: 可以修改各服务的日志级别，或者注释掉 `print` 语句。详细配置请参考各服务的源代码。

## 总结

控制台输出提供了完整的系统运行信息，包括：
- 游戏日志监控状态
- OCR识别结果
- 游戏事件检测
- 交叉验证过程
- 日志保存操作

通过查看控制台输出，可以快速了解系统是否正常工作，以及排查可能出现的问题。
