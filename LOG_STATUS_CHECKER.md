# æ—¥å¿—çŠ¶æ€æ£€æµ‹åŠŸèƒ½

## åŠŸèƒ½æ¦‚è¿°

å‚è€ƒ GameLogMonitor é¡¹ç›®å®ç°äº†æ¸¸æˆæ—¥å¿—çŠ¶æ€æ£€æµ‹åŠŸèƒ½ï¼Œç”¨äºæ£€æµ‹ç©å®¶æ˜¯å¦å¼€å¯äº†æ¸¸æˆæ—¥å¿—åŠŸèƒ½ã€‚

## ä¸»è¦åŠŸèƒ½

### 1. æ—¥å¿—çŠ¶æ€æ£€æµ‹

- **æ¸¸æˆè¿è¡Œæ£€æµ‹**ï¼šæ£€æµ‹æ¸¸æˆè¿›ç¨‹æ˜¯å¦è¿è¡Œ
- **æ—¥å¿—æ–‡ä»¶å­˜åœ¨æ€§æ£€æµ‹**ï¼šæ£€æŸ¥æ¸¸æˆæ—¥å¿—æ–‡ä»¶æ˜¯å¦å­˜åœ¨
- **æ—¥å¿—å¤§å°æ£€æµ‹**ï¼šé€šè¿‡æ–‡ä»¶å¤§å°åˆ¤æ–­æ—¥å¿—æ˜¯å¦å¼€å¯ï¼ˆå°äº 1KB è®¤ä¸ºæœªå¼€å¯ï¼‰
- **æ–‡ä»¶å¯è¯»æ€§æ£€æµ‹**ï¼šæ£€æŸ¥æ—¥å¿—æ–‡ä»¶æ˜¯å¦å¯è¯»
- **æƒé™æ£€æµ‹**ï¼šæ£€æµ‹æ˜¯å¦æœ‰è®¿é—®æ—¥å¿—æ–‡ä»¶çš„æƒé™

### 2. çŠ¶æ€æ˜¾ç¤º

åœ¨ä¸»çª—å£ä¸­æ˜¾ç¤ºæ—¥å¿—çŠ¶æ€æ‘˜è¦ï¼š
- âœ“ æ—¥å¿—æ­£å¸¸ (ç»¿è‰²)
- âš ï¸ æ¸¸æˆæœªè¿è¡Œ (é»„è‰²)
- âš ï¸ æ—¥å¿—æœªå¼€å¯ (é»„è‰²)
- âŒ æƒé™ä¸è¶³ (çº¢è‰²)
- âŒ å…¶ä»–é”™è¯¯ (çº¢è‰²)

### 3. è¯¦ç»†é”™è¯¯æç¤º

ç‚¹å‡»æ—¥å¿—çŠ¶æ€æ ‡ç­¾å¯ä»¥æŸ¥çœ‹è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼š
- æ¸¸æˆæ˜¯å¦è¿è¡Œ
- æ—¥å¿—æ–‡ä»¶è·¯å¾„
- å¤§å°ä¿¡æ¯
- å…·ä½“çš„é”™è¯¯åŸå› 
- è§£å†³å»ºè®®

## ä½¿ç”¨æ–¹æ³•

### è‡ªåŠ¨é›†æˆ

æ—¥å¿—çŠ¶æ€æ£€æµ‹å·²é›†æˆåˆ° `AppController` ä¸­ï¼Œåœ¨çª—å£æ˜¾ç¤ºåè‡ªåŠ¨æ£€æµ‹ï¼š

```python
# controllers/app_controller.py
def on_window_shown(self) -> None:
    """çª—å£æ˜¾ç¤ºåçš„åˆå§‹åŒ–"""
    # æ£€æŸ¥æ—¥å¿—çŠ¶æ€
    self._check_log_status()

    self._ensure_bound_or_exit()
    self._schedule_watch()
```

### æ‰‹åŠ¨ä½¿ç”¨

```python
from services.log_status_checker_service import get_log_status_checker

# è·å–æ£€æµ‹å™¨å®ä¾‹
checker = get_log_status_checker()

# è‡ªåŠ¨æ£€æµ‹ï¼ˆè‡ªåŠ¨æŸ¥æ‰¾æ¸¸æˆæ—¥å¿—è·¯å¾„ï¼‰
status = checker.check_log_status()

# æŒ‡å®šæ—¥å¿—è·¯å¾„æ£€æµ‹
status = checker.check_log_status(log_path="D:\\path\\to\\UE_game.log")

# è·å–çŠ¶æ€æ‘˜è¦
summary = checker.get_status_summary()

# è·å–è¯¦ç»†é”™è¯¯æ¶ˆæ¯
details = checker.get_formatted_error_message()
```

## LogStatus æ•°æ®ç»“æ„

```python
@dataclass
class LogStatus:
    is_enabled: bool          # æ—¥å¿—æ˜¯å¦å¼€å¯
    is_accessible: bool        # æ—¥å¿—æ˜¯å¦å¯è®¿é—®
    log_path: Optional[str]    # æ—¥å¿—æ–‡ä»¶è·¯å¾„
    log_size: int             # æ—¥å¿—æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰
    last_modified: Optional[datetime]  # æœ€åä¿®æ”¹æ—¶é—´
    error_message: Optional[str]        # é”™è¯¯ä¿¡æ¯
    has_permission: bool       # æ˜¯å¦æœ‰è®¿é—®æƒé™
    game_running: bool        # æ¸¸æˆæ˜¯å¦è¿è¡Œ
    process_id: Optional[int] # æ¸¸æˆè¿›ç¨‹ID
```

## æ—¥å¿—æ–‡ä»¶è·¯å¾„

æ¸¸æˆæ—¥å¿—æ–‡ä»¶ä½ç½®ï¼š
```
æ¸¸æˆå®‰è£…ç›®å½•/UE_game/Torchlight/Saved/Logs/UE_game.log
```

ç¤ºä¾‹è·¯å¾„ï¼š
```
D:\TapTap\PC Games\172664\UE_game\Torchlight\Saved\Logs\UE_game.log
```

## å¸¸è§é—®é¢˜

### 1. æ¸¸æˆæœªè¿è¡Œ

**æç¤º**ï¼šâš ï¸ æ¸¸æˆæœªè¿è¡Œ
**è§£å†³**ï¼šå…ˆå¯åŠ¨æ¸¸æˆ

### 2. æ—¥å¿—æœªå¼€å¯

**æç¤º**ï¼šâš ï¸ æ—¥å¿—æ–‡ä»¶ä¸ºç©ºæˆ–å¤ªå°ï¼Œæ¸¸æˆå¯èƒ½æœªå¼€å¯æ—¥å¿—
**è§£å†³**ï¼š
1. åœ¨æ¸¸æˆä¸­å¼€å¯æ—¥å¿—åŠŸèƒ½
2. æ£€æŸ¥æ—¥å¿—æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®
3. é‡å¯æ¸¸æˆä»¥ç”Ÿæˆæ—¥å¿—

### 3. æƒé™ä¸è¶³

**æç¤º**ï¼šâŒ æƒé™ä¸è¶³ï¼Œæ— æ³•è¯»å–æ—¥å¿—æ–‡ä»¶
**è§£å†³**ï¼š
1. ä»¥ç®¡ç†å‘˜æ¨¡å¼è¿è¡Œæœ¬ç¨‹åº
2. æ£€æŸ¥æ—¥å¿—æ–‡ä»¶æƒé™

### 4. æ—¥å¿—æ–‡ä»¶ä¸å­˜åœ¨

**æç¤º**ï¼šâŒ æ—¥å¿—æ–‡ä»¶ä¸å­˜åœ¨: {path}
**è§£å†³**ï¼š
1. æ£€æŸ¥æ¸¸æˆå®‰è£…ç›®å½•æ˜¯å¦æ­£ç¡®
2. ç¡®è®¤æ¸¸æˆå·²è¿è¡Œå¹¶ç”Ÿæˆäº†æ—¥å¿—æ–‡ä»¶

## UI ç•Œé¢

### ä¸»çª—å£

åœ¨ä¸»çª—å£ä¸­ï¼Œæ—¥å¿—çŠ¶æ€æ˜¾ç¤ºåœ¨"ä¸Šæ¬¡æ›´æ–°æ—¶é—´"ä¸‹æ–¹ï¼š

```
æ—¥å¿—çŠ¶æ€ï¼šâœ“ æ—¥å¿—æ­£å¸¸ (2.5 MB)
```

ç‚¹å‡»æ ‡ç­¾å¯ä»¥æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ã€‚

### è¯¦æƒ…å¼¹çª—

æ˜¾ç¤ºè¯¦ç»†çš„æ—¥å¿—çŠ¶æ€ä¿¡æ¯ï¼š

```
æ—¥å¿—çŠ¶æ€æ­£å¸¸
è·¯å¾„: D:\TapTap\PC Games\172664\UE_game\Torchlight\Saved\Logs\UE_game.log
å¤§å°: 2.56 MB
```

æˆ–é”™è¯¯ä¿¡æ¯ï¼š

```
âš ï¸ æ—¥å¿—çŠ¶æ€æ£€æµ‹è­¦å‘Šï¼š
â€¢ æ¸¸æˆæœªè¿è¡Œ
  è¯·å…ˆå¯åŠ¨æ¸¸æˆ

ğŸ’¡ æç¤ºï¼š
â€¢ è¯·æ£€æŸ¥æ¸¸æˆæ—¥å¿—åŠŸèƒ½æ˜¯å¦å·²å¼€å¯
â€¢ æ—¥å¿—æ–‡ä»¶ä½ç½®: æ¸¸æˆå®‰è£…ç›®å½•/UE_game/Torchlight/Saved/Logs/UE_game.log
```

## æŠ€æœ¯ç»†èŠ‚

### å•ä¾‹æ¨¡å¼

`LogStatusChecker` ä½¿ç”¨åŒæ£€é”å•ä¾‹æ¨¡å¼ï¼š

```python
class LogStatusChecker:
    _instance: Optional['LogStatusChecker'] = None
    _lock = threading.Lock()

    def __new__(cls, *args, **kwargs):
        if cls._instance is None:
            with cls._lock:
                if cls._instance is None:
                    cls._instance = super().__new__(cls)
                    cls._instance._initialized = False
        return cls._instance
```

### æ—¥å¿—æŸ¥æ‰¾é€»è¾‘

é€šè¿‡æ¸¸æˆè¿›ç¨‹è‡ªåŠ¨æŸ¥æ‰¾æ—¥å¿—æ–‡ä»¶è·¯å¾„ï¼š

1. æŸ¥æ‰¾ `torchlight_infinite.exe` è¿›ç¨‹
2. è·å–è¿›ç¨‹ exe è·¯å¾„
3. å‘ä¸ŠæŸ¥æ‰¾ `UE_game` ç›®å½•ï¼ˆæœ€å¤š 3 å±‚ï¼‰
4. æ„å»ºæ—¥å¿—æ–‡ä»¶è·¯å¾„ï¼š`UE_game/Torchlight/Saved/Logs/UE_game.log`

### çŠ¶æ€åˆ¤æ–­é€»è¾‘

- **æ—¥å¿—å·²å¼€å¯**ï¼šæ–‡ä»¶å­˜åœ¨ + å¤§äº 1KB + å¯è¯»
- **æ—¥å¿—æœªå¼€å¯**ï¼šæ–‡ä»¶å­˜åœ¨ + å°äº 1KB
- **ä¸å¯è®¿é—®**ï¼šæƒé™ä¸è¶³æˆ–å…¶ä»–è¯»å–é”™è¯¯
- **ä¸å­˜åœ¨**ï¼šæ–‡ä»¶ä¸å­˜åœ¨

## ä¾èµ–

- `psutil`ï¼šç”¨äºè¿›ç¨‹æ£€æµ‹ï¼ˆå¯é€‰ï¼‰
- Python 3.9+

## æµ‹è¯•

è¿è¡Œæµ‹è¯•è„šæœ¬ï¼š

```bash
python test_log_status_checker.py
```

æµ‹è¯•å†…å®¹åŒ…æ‹¬ï¼š
1. è‡ªåŠ¨æŸ¥æ‰¾æ¸¸æˆæ—¥å¿—è·¯å¾„
2. æ˜¾ç¤ºçŠ¶æ€æ‘˜è¦
3. æ˜¾ç¤ºè¯¦ç»†é”™è¯¯ä¿¡æ¯
4. æµ‹è¯•æ‰‹åŠ¨æŒ‡å®šæ—¥å¿—è·¯å¾„

## æœªæ¥æ”¹è¿›

- [ ] æ·»åŠ å®šæœŸè‡ªåŠ¨æ£€æµ‹åŠŸèƒ½
- [ ] æ”¯æŒå¤šä¸ªæ¸¸æˆè¿›ç¨‹
- [ ] æ·»åŠ æ—¥å¿—æ–‡ä»¶å¤§å°å†å²è®°å½•
- [ ] æä¾›æ—¥å¿—æ–‡ä»¶æ‰“å¼€åŠŸèƒ½
- [ ] æ”¯æŒè‡ªå®šä¹‰æ—¥å¿—è·¯å¾„

## å‚è€ƒé¡¹ç›®

- GameLogMonitor (C#)
- D:\GameLogMonitor\Program.cs
- D:\GameLogMonitor\Parsers\LogParser.cs
